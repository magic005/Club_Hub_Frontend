---
layout: post
permalink: /createclub
menu: nav/home.html
show_reading_time: false
---

<br>
<style>
    body {
        margin: 0;
        font-family: 'Roboto', Arial, sans-serif;
        background-color: #0E0E10;
        color: #F3F3F3;
        line-height: 1.6;
    }

    .header {
        background: linear-gradient(to right, #4A00E0, #8E2DE2);
        text-align: center;
        padding: 30px 20px;
        color: #fff;
        font-size: 1.5em;
    }

    .container {
        max-width: 900px;
        margin: 40px auto;
        padding: 20px;
        background: #1A1A1D;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    }

    h1, h2 {
        text-align: center;
        font-weight: 700;
        color: #FF4D4D;
    }

    .show-form-btn {
        background: linear-gradient(to right, #FF416C, #FF4B2B); /* Bright orange/red */
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: block;
        margin: auto;
    }

    .show-form-btn:hover {
        background: linear-gradient(to right, #FF4B2B, #FF416C);
        transform: translateY(-2px);
    }

    .form-container {
        display: none;
        margin-top: 20px;
        padding: 20px;
        background: #2A2A2D;
        border-radius: 8px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        font-size: 1.1em;
    }

    .form-group input {
        width: 100%;
        padding: 10px;
        font-size: 1em;
        border: 1px solid #007bff;
        border-radius: 5px;
        background-color: #0E0E10;
        color: #F3F3F3;
    }

    .button {
        display: block;
        width: 100%;
        padding: 15px;
        margin-top: 10px;
        background: linear-gradient(to right, #FF416C, #FF4B2B);
        color: white;
        font-size: 1.1em;
        font-weight: bold;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .button:hover {
        background: linear-gradient(to right, #FF4B2B, #FF416C);
        transform: translateY(-2px);
    }

    .club-box {
        padding: 15px;
        border-radius: 8px;
        background-color: #2A2A2D;
        margin-bottom: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        text-align: left;
    }

    .club-box h3 {
        margin: 0;
        color: #FF4D4D;
        font-size: 1.4em;
    }

    .club-box p {
        margin: 5px 0;
    }

    .club-actions {
        display: flex;
        justify-content: space-between;
    }

    .small-btn {
        padding: 5px 8px; /* Smaller padding */
        font-size: 12px; /* Smaller text */
        width: auto;
        height: auto;
        border-radius: 3px;
        margin: 3px;
        background: linear-gradient(to right, #FF416C, #FF4B2B); /* Keep bright color */
        color: white;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .small-btn:hover {
        background: linear-gradient(to right, #FF4B2B, #FF416C);
        transform: translateY(-2px);
    }

    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .pagination-btn {
        margin: 0 5px;
        padding: 10px 15px;
        font-size: 13px;
        width: auto;
        height: auto;
        border: none;
        background: linear-gradient(to right, #FF416C, #FF4B2B); /* Keep bright color */
        color: white;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        align-items: center;
        font-weight: bold;
    }

    .pagination-btn:hover {
        background: linear-gradient(to right, #FF4B2B, #FF416C);
        transform: translateY(-2px);
    }

    .pagination-btn:disabled {
        background: linear-gradient(to right, #FF416C, #FF4B2B); /* Keep bright color */
        cursor: not-allowed;
    }  

    .pageIndicator {
        margin: 0 5px;
        padding: 10px 15px;
        width: auto;
        height: auto;
        border: none;
        background: linear-gradient(to right, #FF416C, #FF4B2B); /* Keep bright color */
        border-radius: 5px;
        transition: all 0.3s ease;
    }

    #clubTopics, #editClubTopics {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 3 equal columns */
        gap: 10px 0; /* Space between rows */
        width: 100%;
    }

    #clubTopics label, #editClubTopics label {
        display: flex;
        align-items: center;
        gap: 10px; /* Space between checkbox and text */
        text-align: left;
        padding-left: 10px; /* Ensure consistent left alignment */
        white-space: nowrap;
    }

    #clubTopics input[type="checkbox"], #editClubTopics input[type="checkbox"] {
        width: 20px;  /* Ensure all checkboxes have the same width */
        height: 20px; /* Ensure all checkboxes have the same height */
        margin: 0; /* Remove default spacing */
        flex-shrink: 0; /* Prevent checkboxes from shrinking */
    }

</style>


<body>
    <button class="show-form-btn" id="showFormBtn">Start a New Club</button>
    <div class="form-container" id="formContainer">
        <h2>Club Registration Form</h2>
        <form id="clubForm">
            <div class="form-group">
                <label for="clubName">Club Name</label>
                <input type="text" id="clubName" placeholder="Enter club name" required>
            </div>
            <div class="form-group">
                <label for="clubDescription">Club Description</label>
                <input type="text" id="clubDescription" placeholder="Describe your club" required>
            </div>
            <div class="form-group">
                <label for="clubTopics">Club Topics</label>
                <br>
                <div id="clubTopics">
                    <label><input type="checkbox" name="topics" value="Cybersecurity"> Cyber</label>
                    <label><input type="checkbox" name="topics" value="Robotics"> Robots</label>
                    <label><input type="checkbox" name="topics" value="Artificial Intelligence"> AI</label>
                    <label><input type="checkbox" name="topics" value="Photography"> Photos</label>
                    <label><input type="checkbox" name="topics" value="Space Exploration"> Space</label>
                    <label><input type="checkbox" name="topics" value="Gaming"> Games</label>
                    <label><input type="checkbox" name="topics" value="Programming"> Code</label>
                    <label><input type="checkbox" name="topics" value="Machine Learning"> ML</label>
                    <label><input type="checkbox" name="topics" value="Blockchain"> Chain</label>
                    <label><input type="checkbox" name="topics" value="Music"> Music</label>
                    <label><input type="checkbox" name="topics" value="Art"> Arts</label>
                    <label><input type="checkbox" name="topics" value="Fitness"> Fitness</label>
                    <label><input type="checkbox" name="topics" value="Cooking"> Cooking</label>
                    <label><input type="checkbox" name="topics" value="Travel"> Travel</label>
                    <label><input type="checkbox" name="topics" value="Languages"> Language</label>
                    <label><input type="checkbox" name="topics" value="Entrepreneurship"> Business</label>
                    <label><input type="checkbox" name="topics" value="Finance"> Finance</label>
                    <label><input type="checkbox" name="topics" value="Astronomy"> Stars</label>
                    <label><input type="checkbox" name="topics" value="Cars"> Cars</label>
                    <label><input type="checkbox" name="topics" value="Literature"> Literature</label>
                    <label><input type="checkbox" name="topics" value="Psychology"> Psychology</label>
                    <label><input type="checkbox" name="topics" value="History"> History</label>
                    <label><input type="checkbox" name="topics" value="Mathematics"> Math</label>
                    <label><input type="checkbox" name="topics" value="Biology"> Biology</label>
                    <label><input type="checkbox" name="topics" value="Chemistry"> Chemistry</label>
                    <label><input type="checkbox" name="topics" value="Physics"> Physics</label>
                    <label><input type="checkbox" name="topics" value="Teaching"> Teaching</label>
                    <label><input type="checkbox" name="topics" value="Volunteering"> Volunteering</label>
                    <label><input type="checkbox" name="topics" value="Fashion"> Fashion</label>
                    <label><input type="checkbox" name="topics" value="Fundraising"> Fundraising</label>
                </div>
                <br>
                <small>*Please select all relevant topics for your club.*</small>
                <br>
            </div>
            <button type="submit" class="small-btn">Create Club</button>
            <button type="button" id="closeCreateForm" class="small-btn">Cancel</button>
        </form>
    </div>  
    <br>
    <hr>
    <br>
    <div id="clubListContainer">
        <!-- all new created clubs will be listed in this "container" -->
    </div>

    <div id="editClubModal" class="form-container" style="display: none;">
        <h2>Edit Club</h2>
        <form id="editClubForm">
            <input type="hidden" id="editClubId">
            <div class="form-group">
                <label for="editClubName">Club Name</label>
                <input type="text" id="editClubName" required>
            </div>
            <div class="form-group">
                <label for="editClubDescription">Club Description</label>
                <input type="text" id="editClubDescription" required>
            </div>
            <div class="form-group">
                <label>Club Topics</label>
                    <div id="editClubTopics">
                        <!-- Checkboxes will be populated dynamically -->
                    </div>
                    <small>*Please select all relevant topics for your club.*</small>
            </div>
            <button type="submit" class="small-btn">Update Club</button>
            <button type="button" id="closeEditForm" class="small-btn">Cancel</button>
        </form>
    </div>
    <br>
    <hr>
    <div class="pagination">
        <button id="prevPage" class="pagination-btn" disabled> Previous</button>
        <span id="pageIndicator" class="pageIndicator"></span>
        <button id="nextPage" class="pagination-btn">Next</button>
    </div>
    
    <script type="module">
        import { pythonURI } from "{{site.baseurl}}/assets/js/api/config.js";
        // Declare all DOM elements at the top
        const showFormBtn = document.getElementById('showFormBtn');
        const formContainer = document.getElementById('formContainer');
        const clubForm = document.getElementById('clubForm');
        const clubListContainer = document.getElementById('clubListContainer');

        let currentUserId = null; // Store logged-in user's ID

        // Show the form when the "Start a New Club" button is clicked
        showFormBtn.addEventListener('click', function () {
            formContainer.style.display = 'block';
        });

        function displayNewClub(createdClub) {
            const clubBox = document.createElement("div");
            clubBox.classList.add("club-box");
            clubBox.innerHTML = `
                <h3>${createdClub.name}</h3>
                <p><strong>Description:</strong> ${createdClub.description}</p>
                <p><strong>Topics:</strong> ${createdClub.topics.join(", ")}</p>
                <p><strong>Created by:</strong> ${createdClub.user_id}</p>
            `;

            // Only show "Edit" and "Delete" buttons if the logged-in user is the creator
            if (currentUserId && currentUserId === createdClub.user_id) {
                const clubActions = document.createElement("div");
                clubActions.classList.add("club-actions");

                const editBtn = document.createElement("button");
                editBtn.classList.add("small-btn");
                editBtn.textContent = "Edit";
                editBtn.addEventListener("click", function () {
                    openEditForm(createdClub);
                });

                const deleteBtn = document.createElement("button");
                deleteBtn.classList.add("small-btn");
                deleteBtn.textContent = "Delete Club";
                deleteBtn.addEventListener("click", async function () {
                    await deleteClub(createdClub.id, clubBox);
                });

                clubActions.appendChild(editBtn);
                clubActions.appendChild(deleteBtn);
                clubBox.appendChild(clubActions);
            }

            clubListContainer.appendChild(clubBox);
        }

        function openEditForm(club) {
            document.getElementById("editClubId").value = club.id;
            document.getElementById("editClubName").value = club.name;
            document.getElementById("editClubDescription").value = club.description;

            const topicsContainer = document.getElementById("editClubTopics");
            topicsContainer.innerHTML = ""; // Clear previous checkboxes

            const allTopics = [
                "Cyber", "Robots", "AI", "Photos", "Space", "Games",
                "Code", "ML", "Chain", "Music", "Arts", "Fitness",
                "Cooking", "Travel", "Language", "Business", "Finance",
                "Stars", "Cars", "Literature", "Psychology", "History",
                "Math", "Biology", "Chemistry", "Physics", "Teaching",
                "Volunteering", "Fashion", "Fundraising"
            ];

            allTopics.forEach(topic => {
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.name = "editTopics";
                checkbox.value = topic;
                checkbox.checked = club.topics.includes(topic); // Pre-check if club already has this topic

                const label = document.createElement("label");
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(" " + topic));

                topicsContainer.appendChild(label);
            });

            document.getElementById("editClubModal").style.display = "block";
        }

        async function getCurrentUserId() {
            try {
                const response = await fetch(`${pythonURI}/api/id`, {
                    method: "GET",
                    credentials: "include", // Send authentication token
                });

                if (!response.ok) throw new Error("Failed to fetch user ID");

                const user = await response.json();
                return user.uid; // Return the logged-in user's UID
            } catch (error) {
                console.error("Error fetching user ID:", error);
                return null;
            }
        }

        clubForm.addEventListener("submit", async function (e) {
            e.preventDefault();

            const clubName = document.getElementById("clubName").value.trim();
            const clubDescription = document.getElementById("clubDescription").value.trim();

            const selectedTopics = [];
            document.querySelectorAll('input[name="topics"]:checked').forEach((checkbox) => {
                selectedTopics.push(checkbox.value);
            });

            if (clubName && clubDescription && selectedTopics.length > 0) {
                try {
                    const userId = await getCurrentUserId();
                    if (!userId) {
                        alert("User authentication failed. Please log in.");
                        return;
                    }

                    const payload = {
                        name: clubName,
                        description: clubDescription,
                        topics: selectedTopics,
                        user_id: userId,  // Include user_id in the request
                    };

                    const response = await fetch(`${pythonURI}/api/club`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        credentials: "include",
                        body: JSON.stringify(payload),
                    });

                    if (response.ok) {
                        const createdClub = await response.json();

                        // Add the new club to the data array
                        clubsData.push(createdClub);

                        // Move to the last page where the new club should be
                        currentPage = Math.floor((clubsData.length - 1) / clubsPerPage);

                        // Re-render the pagination to show the new club in the correct spot
                        displayPaginatedClubs();

                        // Reset the form and hide it
                        clubForm.reset();
                        formContainer.style.display = "none";

                    } else {
                        const error = await response.json();
                        alert(`Error: ${error.message}`);
                    }
                } catch (error) {
                    alert("An error occurred while creating the club. Please try again.");
                    console.error(error);
                }
            } else {
                alert("Please fill out all fields and select at least one topic!");
            }
        });


        document.getElementById("closeCreateForm").addEventListener("click", function () {
            document.getElementById("formContainer").style.display = "none"; // Hide the form
        });


        let clubsData = []; // Store all fetched clubs
        let currentPage = 0; // Track the current page
        const clubsPerPage = 3; // Display 3 clubs per page

        async function fetchAndDisplayClubs() {
            try {
                // Fetch logged-in user's ID
                const userResponse = await fetch(`${pythonURI}/api/id`, {
                    method: "GET",
                    credentials: "include",
                });

                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    currentUserId = userData.uid; // Store logged-in user's ID
                } else {
                    console.warn("Failed to fetch logged-in user ID.");
                }

                // Fetch all clubs
                const response = await fetch(`${pythonURI}/api/club`, {
                    method: "GET",
                    headers: { "Content-Type": "application/json" },
                    credentials: "include",
                });

                if (response.ok) {
                    clubsData = await response.json(); // Store clubs in an array
                    displayPaginatedClubs(); // Show the first page
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.message}`);
                }
            } catch (error) {
                console.error("Error fetching clubs:", error);
            }
        }

        function displayPaginatedClubs() {
            clubListContainer.innerHTML = ""; // Clear previous clubs

            const startIndex = currentPage * clubsPerPage;
            const endIndex = startIndex + clubsPerPage;
            const clubsToShow = clubsData.slice(startIndex, endIndex);

            clubsToShow.forEach(club => displayNewClub(club));

            updatePaginationButtons();
        }

        function updatePaginationButtons() {
            document.getElementById("pageIndicator").textContent = `Page ${currentPage + 1}`;

            document.getElementById("prevPage").disabled = currentPage === 0;
            document.getElementById("nextPage").disabled = (currentPage + 1) * clubsPerPage >= clubsData.length;

            // Hide pagination buttons if there are less than 3 clubs
            const pagination = document.querySelector(".pagination");
            pagination.style.display = clubsData.length > clubsPerPage ? "flex" : "none";
        }

        document.getElementById("prevPage").addEventListener("click", function () {
            if (currentPage > 0) {
                currentPage--;
                displayPaginatedClubs();
            }
        });

        document.getElementById("nextPage").addEventListener("click", function () {
            if ((currentPage + 1) * clubsPerPage < clubsData.length) {
                currentPage++;
                displayPaginatedClubs();
            }
        });

        document.getElementById("editClubForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const clubId = document.getElementById("editClubId").value;
            const updatedName = document.getElementById("editClubName").value.trim();
            const updatedDescription = document.getElementById("editClubDescription").value.trim();

            // Collect selected topics from checkboxes
            const selectedTopics = [];
            document.querySelectorAll('input[name="editTopics"]:checked').forEach(checkbox => {
                selectedTopics.push(checkbox.value);
            });

            if (!updatedName || !updatedDescription || selectedTopics.length === 0) {
                alert("All fields must be filled out and at least one topic must be selected!");
                return;
            }

            const payload = {
                id: clubId,
                name: updatedName,
                description: updatedDescription,
                topics: selectedTopics, // Send selected topics as an array
            };

            try {
                const response = await fetch(`${pythonURI}/api/club`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    credentials: "include",
                    body: JSON.stringify(payload),
                });

                if (response.ok) {
                    document.getElementById("editClubModal").style.display = "none";
                    alert("Club updated successfully!");

                    // Refresh the club list to reflect changes
                    fetchAndDisplayClubs();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.message}`);
                }
            } catch (error) {
                console.error("Error updating club:", error);
                alert("An error occurred while updating the club. Please try again.");
            }
        });

        document.getElementById("closeEditForm").addEventListener("click", function () {
            document.getElementById("editClubModal").style.display = "none";
        });

        // Function to delete a club
        async function deleteClub(clubId, clubBox) {
            try {
                const response = await fetch(`${pythonURI}/api/club`, {
                    method: "DELETE",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    credentials: "include",
                    body: JSON.stringify({ id: clubId }),
                });

                if (response.ok) {
                    // Remove from local clubsData array
                    clubsData = clubsData.filter(club => club.id !== clubId);

                    // Recalculate the page index in case last page is empty
                    if (currentPage * clubsPerPage >= clubsData.length && currentPage > 0) {
                        currentPage--;
                    }

                    // Re-render the paginated club list
                    displayPaginatedClubs();

                } else {
                    const error = await response.json();
                    alert(`Error: ${error.message}`);
                }
            } catch (error) {
                alert("An error occurred while deleting the club. Please try again.");
                console.error(error);
            }
        }

        // Call fetchAndDisplayClubs on page load
        document.addEventListener('DOMContentLoaded', fetchAndDisplayClubs);
    </script>