---
layout: post
title: Club Creator
permalink: /createclub
menu: nav/home.html
show_reading_time: false
---

<br>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #FDF5E6;
        text-align: center;
        padding: 50px;
    }

    .form-container {
        display: none;
        /* Hidden initially */
        margin-top: 20px;
        padding: 20px;
        border: 2px solid #FF3B3B;
        border-radius: 8px;
        background-color: #001F3F;
        width: 75%;
        margin: 0 auto;
    }

    .form-group {
        margin: 15px 0;
    }

    .form-group label {
        display: block;
        font-size: 18px;
    }

    .form-group input {
        width: 90%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #007bff;
        border-radius: 5px;
    }

    .submit-btn {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .submit-btn:hover {
        background-color: #0056b3;
    }

    .show-form-btn {
        background-color: #28a745;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        border: 2px solid #FF3B3B;
        border-radius: 5px;
        cursor: pointer;
    }

    .show-form-btn:hover {
        background-color: #218838;
    }

    .club-box {
        margin-top: 20px;
        padding: 20px;
        border: 2px solid #FF3B3B;
        border-radius: 8px;
        background-color: #073461;
        color: white;
        width: 50%;
        margin: 20px auto;
    }

    .club-box h3 {
        margin: 0;
        padding-bottom: 10px;
        font-size: 24px;
    }

    .club-box p {
        margin: 5px 0;
    }

    #clubTopics {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        /* 3 equal-width columns */
        gap: 10px 0;
        /* Add vertical spacing between rows */
    }

    #clubTopics label {
        display: grid;
        grid-template-columns: 20px auto;
        /* Fixed width for checkboxes */
        align-items: center;
        /* Center checkbox and text vertically */
        justify-items: start;
        /* Align text to the left */
        gap: 10px;
        /* Space between checkbox and text */
    }

    #editClubTopics {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 3 equal-width columns */
        gap: 10px 0; /* Add vertical spacing between rows */
    }

    #editClubTopics label {
        display: grid;
        grid-template-columns: 20px auto; /* Fixed width for checkboxes */
        align-items: center; /* Center checkbox and text vertically */
        justify-items: start; /* Align text to the left */
        gap: 10px; /* Space between checkbox and text */
    }

</style>

<body>
    <br>
    <button class="show-form-btn" id="showFormBtn">Start a New Club</button>
    <br>
    <div class="form-container" id="formContainer">
        <h2>Club Registration Form</h2>
        <form id="clubForm">
            <div class="form-group">
                <label for="clubName">Club Name</label>
                <input type="text" id="clubName" placeholder="Enter club name" required>
            </div>
            <div class="form-group">
                <label for="clubDescription">Club Description</label>
                <input type="text" id="clubDescription" placeholder="Describe your club" required>
            </div>
            <div class="form-group">
                <label for="clubTopics">Club Topics</label>
                <br>
                <div id="clubTopics">
                    <label><input type="checkbox" name="topics" value="Cyber"> Cyber</label>
                    <label><input type="checkbox" name="topics" value="Robots"> Robots</label>
                    <label><input type="checkbox" name="topics" value="AI"> AI</label>
                    <label><input type="checkbox" name="topics" value="Photos"> Photos</label>
                    <label><input type="checkbox" name="topics" value="Space"> Space</label>
                    <label><input type="checkbox" name="topics" value="Games"> Games</label>
                    <label><input type="checkbox" name="topics" value="Code"> Code</label>
                    <label><input type="checkbox" name="topics" value="ML"> ML</label>
                    <label><input type="checkbox" name="topics" value="Chain"> Chain</label>
                    <label><input type="checkbox" name="topics" value="Music"> Music</label>
                    <label><input type="checkbox" name="topics" value="Arts"> Arts</label>
                    <label><input type="checkbox" name="topics" value="Fitness"> Fitness</label>
                    <label><input type="checkbox" name="topics" value="Cooking"> Cooking</label>
                    <label><input type="checkbox" name="topics" value="Travel"> Travel</label>
                    <label><input type="checkbox" name="topics" value="Language"> Language</label>
                    <label><input type="checkbox" name="topics" value="Business"> Business</label>
                    <label><input type="checkbox" name="topics" value="Finance"> Finance</label>
                    <label><input type="checkbox" name="topics" value="Stars"> Stars</label>
                    <label><input type="checkbox" name="topics" value="Cars"> Cars</label>
                    <label><input type="checkbox" name="topics" value="Literature"> Literature</label>
                    <label><input type="checkbox" name="topics" value="Psychology"> Psychology</label>
                    <label><input type="checkbox" name="topics" value="History"> History</label>
                    <label><input type="checkbox" name="topics" value="Math"> Math</label>
                    <label><input type="checkbox" name="topics" value="Biology"> Biology</label>
                    <label><input type="checkbox" name="topics" value="Chemistry"> Chemistry</label>
                    <label><input type="checkbox" name="topics" value="Physics"> Physics</label>
                    <label><input type="checkbox" name="topics" value="Teaching"> Teaching</label>
                    <label><input type="checkbox" name="topics" value="Volunteering"> Volunteering</label>
                    <label><input type="checkbox" name="topics" value="Fashion"> Fashion</label>
                    <label><input type="checkbox" name="topics" value="Fundraising"> Fundraising</label>
                </div>
                <br>
                <small>*Please select all relevant topics for your club.*</small>
                <br>
            </div>
            <button type="submit" class="submit-btn">Create Club</button>
        </form>
    </div>

    <div id="editClubModal" class="form-container" style="display: none;">
        <h2>Edit Club</h2>
        <form id="editClubForm">
            <input type="hidden" id="editClubId">
            <div class="form-group">
                <label for="editClubName">Club Name</label>
                <input type="text" id="editClubName" required>
            </div>
            <div class="form-group">
                <label for="editClubDescription">Club Description</label>
                <input type="text" id="editClubDescription" required>
            </div>
            <div class="form-group">
                <label>Club Topics</label>
                    <div id="editClubTopics">
                        <!-- Checkboxes will be populated dynamically -->
                    </div>
                    <small>*Please select all relevant topics for your club.*</small>
            </div>
            <button type="submit" class="submit-btn">Update Club</button>
            <button type="button" id="closeEditForm" class="submit-btn">Cancel</button>
        </form>
    </div>
    

    <div id="clubListContainer">
        <!-- all new created clubs will be listed in this "container" -->
    </div>

    <div id="paginationControls">
        <button id="prevPage" class="pagination-btn">◀ Previous</button>
        <span id="pageIndicator"></span>
        <button id="nextPage" class="pagination-btn">Next ▶</button>
    </div>
    
    <script type="module">
        import { pythonURI } from "{{site.baseurl}}/assets/js/api/config.js";
        // Declare all DOM elements at the top
        const showFormBtn = document.getElementById('showFormBtn');
        const formContainer = document.getElementById('formContainer');
        const clubForm = document.getElementById('clubForm');
        const clubListContainer = document.getElementById('clubListContainer');

        let currentUserId = null; // Store logged-in user's ID

        // Show the form when the "Start a New Club" button is clicked
        showFormBtn.addEventListener('click', function () {
            formContainer.style.display = 'block';
        });

        function displayNewClub(createdClub) {
            const clubBox = document.createElement("div");
            clubBox.classList.add("club-box");
            clubBox.innerHTML = `
                <h3>${createdClub.name}</h3>
                <p><strong>Description:</strong> ${createdClub.description}</p>
                <p><strong>Topics:</strong> ${createdClub.topics.join(", ")}</p>
                <p><strong>Created by:</strong> ${createdClub.user_id}</p>
            `;

            // Only show "Edit" and "Delete" buttons if the logged-in user is the creator
            if (currentUserId && currentUserId === createdClub.user_id) {
                const editBtn = document.createElement("button");
                editBtn.classList.add("edit-btn");
                editBtn.textContent = "Edit";
                editBtn.addEventListener("click", function () {
                    openEditForm(createdClub);
                });

                const deleteBtn = document.createElement("button");
                deleteBtn.classList.add("delete-btn");
                deleteBtn.textContent = "Delete Club";
                deleteBtn.addEventListener("click", async function () {
                    await deleteClub(createdClub.id, clubBox);
                });

                clubBox.appendChild(editBtn);
                clubBox.appendChild(deleteBtn);
            }

            clubListContainer.appendChild(clubBox);
        }


        function openEditForm(club) {
            document.getElementById("editClubId").value = club.id;
            document.getElementById("editClubName").value = club.name;
            document.getElementById("editClubDescription").value = club.description;

            const topicsContainer = document.getElementById("editClubTopics");
            topicsContainer.innerHTML = ""; // Clear previous checkboxes

            const allTopics = [
                "Cyber", "Robots", "AI", "Photos", "Space", "Games",
                "Code", "ML", "Chain", "Music", "Arts", "Fitness",
                "Cooking", "Travel", "Language", "Business", "Finance",
                "Stars", "Cars", "Literature", "Psychology", "History",
                "Math", "Biology", "Chemistry", "Physics", "Teaching",
                "Volunteering", "Fashion", "Fundraising"
            ];

            allTopics.forEach(topic => {
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.name = "editTopics";
                checkbox.value = topic;
                checkbox.checked = club.topics.includes(topic); // Pre-check if club already has this topic

                const label = document.createElement("label");
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(" " + topic));

                topicsContainer.appendChild(label);
            });

            document.getElementById("editClubModal").style.display = "block";
        }

        async function getCurrentUserId() {
            try {
                const response = await fetch(`${pythonURI}/api/id`, {
                    method: "GET",
                    credentials: "include", // Send authentication token
                });

                if (!response.ok) throw new Error("Failed to fetch user ID");

                const user = await response.json();
                return user.uid; // Return the logged-in user's UID
            } catch (error) {
                console.error("Error fetching user ID:", error);
                return null;
            }
        }

        clubForm.addEventListener("submit", async function (e) {
            e.preventDefault();

            const clubName = document.getElementById("clubName").value.trim();
            const clubDescription = document.getElementById("clubDescription").value.trim();

            const selectedTopics = [];
            document.querySelectorAll('input[name="topics"]:checked').forEach((checkbox) => {
                selectedTopics.push(checkbox.value);
            });

            if (clubName && clubDescription && selectedTopics.length > 0) {
                try {
                    const userId = await getCurrentUserId();
                    if (!userId) {
                        alert("User authentication failed. Please log in.");
                        return;
                    }

                    const payload = {
                        name: clubName,
                        description: clubDescription,
                        topics: selectedTopics,
                        user_id: userId,  // Include user_id in the request
                    };

                    const response = await fetch(`${pythonURI}/api/club`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        credentials: "include",
                        body: JSON.stringify(payload),
                    });

                    if (response.ok) {
                        const createdClub = await response.json();
                        displayNewClub(createdClub);
                        clubForm.reset();
                        formContainer.style.display = "none";
                    } else {
                        const error = await response.json();
                        alert(`Error: ${error.message}`);
                    }
                } catch (error) {
                    alert("An error occurred while creating the club. Please try again.");
                    console.error(error);
                }
            } else {
                alert("Please fill out all fields and select at least one topic!");
            }
        });

        let clubsData = []; // Store all fetched clubs
        let currentPage = 0; // Track the current page
        const clubsPerPage = 3; // Display 3 clubs per page

        async function fetchAndDisplayClubs() {
            try {
                // Fetch logged-in user's ID
                const userResponse = await fetch(`${pythonURI}/api/id`, {
                    method: "GET",
                    credentials: "include",
                });

                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    currentUserId = userData.uid; // ✅ Store logged-in user's ID
                } else {
                    console.warn("Failed to fetch logged-in user ID.");
                }

                // Fetch all clubs
                const response = await fetch(`${pythonURI}/api/club`, {
                    method: "GET",
                    headers: { "Content-Type": "application/json" },
                    credentials: "include",
                });

                if (response.ok) {
                    clubsData = await response.json(); // ✅ Store clubs in an array
                    displayPaginatedClubs(); // ✅ Show the first page
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.message}`);
                }
            } catch (error) {
                console.error("Error fetching clubs:", error);
            }
        }

        function displayPaginatedClubs() {
            clubListContainer.innerHTML = ""; // Clear previous clubs

            const startIndex = currentPage * clubsPerPage;
            const endIndex = startIndex + clubsPerPage;
            const clubsToShow = clubsData.slice(startIndex, endIndex); // Get 3 clubs for this page

            clubsToShow.forEach(club => displayNewClub(club)); // ✅ Show only 3 clubs

            updatePaginationButtons();
        }

        function updatePaginationButtons() {
            document.getElementById("pageIndicator").textContent = `Page ${currentPage + 1} of ${Math.ceil(clubsData.length / clubsPerPage)}`;

            document.getElementById("prevPage").disabled = currentPage === 0; // Disable on first page
            document.getElementById("nextPage").disabled = (currentPage + 1) * clubsPerPage >= clubsData.length; // Disable on last page
        }

        document.getElementById("prevPage").addEventListener("click", function () {
            if (currentPage > 0) {
                currentPage--;
                displayPaginatedClubs();
            }
        });

        document.getElementById("nextPage").addEventListener("click", function () {
            if ((currentPage + 1) * clubsPerPage < clubsData.length) {
                currentPage++;
                displayPaginatedClubs();
            }
        });

        document.getElementById("editClubForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const clubId = document.getElementById("editClubId").value;
            const updatedName = document.getElementById("editClubName").value.trim();
            const updatedDescription = document.getElementById("editClubDescription").value.trim();

            // Collect selected topics from checkboxes
            const selectedTopics = [];
            document.querySelectorAll('input[name="editTopics"]:checked').forEach(checkbox => {
                selectedTopics.push(checkbox.value);
            });

            if (!updatedName || !updatedDescription || selectedTopics.length === 0) {
                alert("All fields must be filled out and at least one topic must be selected!");
                return;
            }

            const payload = {
                id: clubId,
                name: updatedName,
                description: updatedDescription,
                topics: selectedTopics, // Send selected topics as an array
            };

            try {
                const response = await fetch(`${pythonURI}/api/club`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    credentials: "include",
                    body: JSON.stringify(payload),
                });

                if (response.ok) {
                    document.getElementById("editClubModal").style.display = "none";
                    alert("Club updated successfully!");

                    // Refresh the club list to reflect changes
                    fetchAndDisplayClubs();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.message}`);
                }
            } catch (error) {
                console.error("Error updating club:", error);
                alert("An error occurred while updating the club. Please try again.");
            }
        });

        document.getElementById("closeEditForm").addEventListener("click", function () {
            document.getElementById("editClubModal").style.display = "none";
        });

        // Function to delete a club
        async function deleteClub(clubId, clubBox) {
            try {
                const response = await fetch(`${pythonURI}/api/club`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ id: clubId })
                });

                if (response.ok) {
                    // Remove the club from the page if deletion is successful
                    clubBox.remove();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.message}`);
                }
            } catch (error) {
                alert('An error occurred while deleting the club. Please try again.');
                console.error(error);
            }
        }

        // Call fetchAndDisplayClubs on page load
        document.addEventListener('DOMContentLoaded', fetchAndDisplayClubs);
    </script>